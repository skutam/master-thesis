<?php

$CLASSES = array(
    array(mb_chr(0),mb_chr(1),mb_chr(2),mb_chr(3),mb_chr(4),mb_chr(5),mb_chr(6),mb_chr(7),mb_chr(8),mb_chr(10),mb_chr(11),mb_chr(10),mb_chr(14),mb_chr(15),mb_chr(16),mb_chr(17),mb_chr(18),mb_chr(19),mb_chr(20),mb_chr(21),mb_chr(22),mb_chr(23),mb_chr(24),mb_chr(25),mb_chr(26),mb_chr(27)),
    array(mb_chr(9),mb_chr(12),mb_chr(28),mb_chr(29),mb_chr(30),mb_chr(31),mb_chr(32),mb_chr(133),mb_chr(160),mb_chr(5760),mb_chr(6158),mb_chr(8192),mb_chr(8193),mb_chr(8194),mb_chr(8195),mb_chr(8196),mb_chr(8197),mb_chr(8198),mb_chr(8199),mb_chr(8200),mb_chr(8201),mb_chr(8202),mb_chr(8232),mb_chr(8233),mb_chr(8239),mb_chr(8287),mb_chr(12288)),
    array(mb_chr(97),mb_chr(98),mb_chr(99),mb_chr(100),mb_chr(101),mb_chr(102),mb_chr(103),mb_chr(104),mb_chr(105),mb_chr(106),mb_chr(107),mb_chr(108),mb_chr(109),mb_chr(110),mb_chr(111),mb_chr(112),mb_chr(113),mb_chr(114),mb_chr(115),mb_chr(116),mb_chr(117),mb_chr(118),mb_chr(119),mb_chr(120),mb_chr(121),mb_chr(122)),
    array(mb_chr(65),mb_chr(66),mb_chr(67),mb_chr(68),mb_chr(69),mb_chr(70),mb_chr(71),mb_chr(72),mb_chr(73),mb_chr(74),mb_chr(75),mb_chr(76),mb_chr(77),mb_chr(78),mb_chr(79),mb_chr(80),mb_chr(81),mb_chr(82),mb_chr(83),mb_chr(84),mb_chr(85),mb_chr(86),mb_chr(87),mb_chr(88),mb_chr(89),mb_chr(90)),
    array(mb_chr(48),mb_chr(49),mb_chr(50),mb_chr(51),mb_chr(52),mb_chr(53),mb_chr(54),mb_chr(55),mb_chr(56),mb_chr(57)),
    array(mb_chr(3)),
    array(mb_chr(33),mb_chr(34),mb_chr(35),mb_chr(36),mb_chr(37),mb_chr(38),mb_chr(39),mb_chr(40),mb_chr(41),mb_chr(42),mb_chr(43),mb_chr(44),mb_chr(45),mb_chr(46),mb_chr(47),mb_chr(58),mb_chr(59),mb_chr(60),mb_chr(61),mb_chr(62),mb_chr(63),mb_chr(64)),
    array(mb_chr(91),mb_chr(92),mb_chr(93),mb_chr(94),mb_chr(95),mb_chr(96)),
    array(mb_chr(123),mb_chr(124),mb_chr(125),mb_chr(126),mb_chr(127)),
    array(mb_chr(166),mb_chr(174),mb_chr(177),mb_chr(182),mb_chr(184),mb_chr(186),mb_chr(192),mb_chr(194),mb_chr(195),mb_chr(197),mb_chr(201),mb_chr(202),mb_chr(203),mb_chr(204),mb_chr(205),mb_chr(206),mb_chr(207),mb_chr(208),mb_chr(209),mb_chr(210),mb_chr(211),mb_chr(214),mb_chr(215),mb_chr(224),mb_chr(225),mb_chr(226),mb_chr(227),mb_chr(228),mb_chr(229),mb_chr(230),mb_chr(231),mb_chr(232),mb_chr(233),mb_chr(234),mb_chr(235),mb_chr(236),mb_chr(237),mb_chr(238),mb_chr(239),mb_chr(240),mb_chr(241),mb_chr(242),mb_chr(243),mb_chr(244),mb_chr(245),mb_chr(246),mb_chr(248),mb_chr(249),mb_chr(251),mb_chr(252),mb_chr(253),mb_chr(254),mb_chr(255)),
    array(mb_chr(382)),
    array(mb_chr(8226))
);

$CLASSES_CHARACTERS = array('2 4'=>array( 317978512,628133181),'4'=>array( 97877839,310154669),'2'=>array( 97771865,212276830),'2 3 4'=>array( 55401000,114504965),'3 4'=>array( 27184903,59103965),'2 3'=>array( 16389699,31919062),'3'=>array( 10622042,15529363),'2 6'=>array( 1575028,4907321),'2 4 6'=>array( 1482417,3332293),'4 6'=>array( 533489,1849876),'2 3 4 6'=>array( 286536,1316387),'2 7'=>array( 263533,1029851),'2 4 7'=>array( 256601,766318),'2 3 6'=>array( 153473,509717),'3 6'=>array( 63740,356244),'4 7'=>array( 60629,292504),'3 4 6'=>array( 44749,231875),'2 3 4 7'=>array( 39017,187126),'2 3 7'=>array( 31370,148109),'6'=>array( 30809,116739),'1 2 4'=>array( 18669,85930),'1 2'=>array( 14000,67261),'3 7'=>array( 9494,53261),'1 4'=>array( 7812,43767),'3 4 7'=>array( 6980,35955),'6 7'=>array( 5677,28975),'4 6 7'=>array( 4020,23298),'1 2 3'=>array( 3339,19278),'7'=>array( 2683,15939),'2 6 7'=>array( 2575,13256),'1 2 3 4'=>array( 1936,10681),'1 3'=>array( 1645,8745),'9'=>array( 1258,7100),'2 4 6 7'=>array( 973,5842),'4 8'=>array( 893,4869),'6 8'=>array( 437,3976),'8'=>array( 434,3539),'2 8'=>array( 376,3105),'2 9'=>array( 361,2729),'1 3 4'=>array( 283,2368),'1 6'=>array( 277,2085),'2 3 4 6 7'=>array( 252,1808),'3 6 7'=>array( 238,1556),'6 7 8'=>array( 233,1318),'3 8'=>array( 155,1085),'2 4 8'=>array( 140,930),'1 4 6'=>array( 138,790),'4 6 8'=>array( 131,652),'2 3 6 7'=>array( 86,521),'2 3 4 8'=>array( 78,435),'4 9'=>array( 68,357),'2 3 8'=>array( 42,289),'3 4 6 7'=>array( 36,247),'1'=>array( 25,211),'2 6 8'=>array( 25,186),'2 3 9'=>array( 23,161),'7 8'=>array( 22,138),'1 2 6'=>array( 22,116),'1 4 7'=>array( 19,94),'2 3 7 8'=>array( 14,75),'11'=>array( 10,61),'0'=>array( 7,51),'2 4 6 8'=>array( 7,44),'3 4 8'=>array( 7,37),'1 2 7'=>array( 7,30),'1 2 4 6'=>array( 6,23),'10 2'=>array( 5,17),'6 9'=>array( 3,12),'2 4 6 7 8'=>array( 3,9),'2 3 4 6 7 8'=>array( 3,6),'1 2 3 6'=>array( 2,3),'2 4 9'=>array( 1,1));
$CLASSES_CHARACTERS_SUM = 628133181;

function char_class_analysis(string $password) {
    global $CLASSES, $CLASSES_CHARACTERS, $CLASSES_CHARACTERS_SUM;
    $classes_found = [];

    for ($i=0; $i < mb_strlen($password); $i++) { 
        $char = mb_substr($password, $i, 1);

        for ($j=0; $j < count($CLASSES); $j++) { 
            if (in_array($char, $CLASSES[$j])) {
                array_push($classes_found, $j);
            }
        }
    }

    $classes_found_count = count($classes_found);
    $classes_found = array_unique($classes_found, SORT_NUMERIC);

    $classes_str = join(' ', $classes_found);

    if (array_key_exists($classes_str, $CLASSES_CHARACTERS)) {
        $res = $CLASSES_CHARACTERS[$classes_str];
        return array(
            'character_class_analysis' => array(
                $classes_str => $res[0]
            ),
            'result' => ($res[1] / $CLASSES_CHARACTERS_SUM)
        );
    }

    return array(
        'character_class_analysis' => array(),
        'result' => 0.0
    );

}

?>